<div class="flex flex-col justify-center items-center">
    <div class="mr-[50px] ml-[50px] mt-[45px] w-[900px]">
        <h1 class="flex justify-center w-full mb-[95px] text-[22px]">{{title}}</h1>
        <div class="border border-black border-opacity-40 rounded-[1.5rem] p-4 max-w-4xl shadow-md">
            <div class="flex justify-between gap-10 items-center mb-4">  
                <div class="flex flex-col">
                    <h1 class="text-xl font-bold ">{{type}}</h1>
                    <span class="text-sm text-[#B5B5C3]">{{Count}} {{type}}</span>
                </div>
                <form class="flex">
                    <input [(ngModel)]="searchTerm" (keyup.enter)="filterItems()" class="px-4 py-1.5 border w-[25rem] border-gray-300 rounded-lg bg-gray-100 focus:bg-white focus:outline-none focus:ring-1 focus:ring-gray-400" type="text" placeholder="Search items.." name="searchTerm">
                </form>
                <div class="flex items-center relative">
                    <div class="dropdown ">
                        <label tabIndex="0" class="btn btn-sm no-animation border-opacity-60 hover:bg-white bg-white text-black font-semibold font-sans">
                            <span> Sort By:  {{currentFilter ? currentFilter : ''}} </span>
                            <svg class="h-7 w-5 text-black" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                            </svg>
                        </label>
                        <ul tabIndex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52">
                            <li *ngFor="let filter of filterBy">
                                <a (click)="sortTable(filter)">{{filter}}</a>             
                            </li>
                        </ul>
                    </div>
                    <button (click)="openUserModal()" *ngIf="type === 'Users'" class="relative ml-7 w-[32px] h-[32px] p-1 rounded-md bg-[#6b73fa]">
                        <img src="assets/Add User.png" />
                    </button>
                    <button (click)="openBookModal()" *ngIf="type === 'Books'" class="relative ml-7 w-[32px] h-[32px] p-1 rounded-md bg-[#14ae5c]">
                        <img src="assets/Add Book.png" />
                    </button>
                </div>
            </div> 
            <div class="max-h-[300px] min-h-[300px] overflow-y-scroll">
                <table class="w-full">
                    <thead>
                        <tr class="text-left">
                            <th *ngFor="let header of header" class="px-4 py-2">{{header}}</th>
                            <th class="px-4 py-2">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <ng-container *ngFor="let item of filteredItems">
                            <tr class="border-t hover:bg-gray-200 cursor-pointer" (click)="onUserRowClick(item)">
                                <td class="px-4 py-2">{{item.name.length > 18 ? (item.name | slice:0:30) + '...' : item.name}}</td>
                                <td class="px-4 py-2">{{item.id}}</td>
                                <td class="px-4 py-2">
                                {{ 
                                    item.isbn && item.isbn[0] != "" ? item.isbn[0] :
                                    item.groupMembers ? (item.groupMembers.slice(0, 2).join(', ') + (item.groupMembers.length > 2 ? '...' : '')): 
                                    item.Email ? item.Email : "None"
                                }}
                                </td>
                                <td class="px-4 py-2">{{(item.publishDate ? item.publishDate : item.dateAdded) | date: 'yyyy/MM/dd' : 'UTC'}}</td>                                
                                <td class="px-4 py-2">
                                    <button (click)="openDeleteModal(item)" class="bg-[#F3F6F9] text-white font-bold p-1.5 rounded">
                                        <svg viewBox="0 0 1024 1024" width="20px" height="20px" xmlns="http://www.w3.org/2000/svg" fill="#ff0000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path fill="#ff0000" d="M160 256H96a32 32 0 0 1 0-64h256V95.936a32 32 0 0 1 32-32h256a32 32 0 0 1 32 32V192h256a32 32 0 1 1 0 64h-64v672a32 32 0 0 1-32 32H192a32 32 0 0 1-32-32V256zm448-64v-64H416v64h192zM224 896h576V256H224v640zm192-128a32 32 0 0 1-32-32V416a32 32 0 0 1 64 0v320a32 32 0 0 1-32 32zm192 0a32 32 0 0 1-32-32V416a32 32 0 0 1 64 0v320a32 32 0 0 1-32 32z"></path></g>
                                        </svg>
                                    </button>
                                </td>
                            </tr>
                        </ng-container>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <app-user-details *ngIf="type === 'Users'"  [selectedUser]="selectedItem" (updatedUser)="onUpdatedItem($event)"> </app-user-details>
    <app-group-details *ngIf="type === 'Groups'" [selectedGroup]="selectedItem"> </app-group-details>
    <app-book-details *ngIf="type === 'Books'" [selectedBook]="selectedItem" (updatedBook)="onUpdatedItem($event)"> </app-book-details>
</div>
<!--Delete Modal-->
<div class="modal" id="delete-modal">
    <div *ngIf="selectedItem" class="modal-box flex flex-col justify-center items-center w-fit p-6">
        <svg width="50px" height="50px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M12 14a1 1 0 0 1-1-1v-3a1 1 0 1 1 2 0v3a1 1 0 0 1-1 1zm-1.5 2.5a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0z" fill="#ff0000"></path><path d="M10.23 3.216c.75-1.425 2.79-1.425 3.54 0l8.343 15.852C22.814 20.4 21.85 22 20.343 22H3.657c-1.505 0-2.47-1.6-1.77-2.931L10.23 3.216zM20.344 20L12 4.147 3.656 20h16.688z" fill="#ff0000"></path></g></svg>
        <div class="flex flex-col justify-center items-center">
            <h3 class="font-bold text-lg mt-4">Are you sure you want to delete:</h3>
            <span class="font-normal underline">{{selectedItem.name}}</span> 
        </div>
        <p class="mt-1">Once deleted, you can't access the book.</p>
        <div class="modal-action gap-5">
            <a class="btn min-h-[2.5rem] h-[2.5rem] text-black bg-gray-200 border-none hover:bg-gray-200 w-[7rem] rounded-full" (click)="closeDeleteModal()">No</a>
            <a class="btn min-h-[2.5rem] h-[2.5rem] text-white bg-red-600 border-none hover:bg-red-600 w-[7rem] rounded-full" (click)="deleteItem()">Yes</a>
        </div>
    </div>
</div>
<!--Create User Modal-->
<div class="modal" id="new-user-modal">
    <div class="modal-box flex flex-col justify-center items-center w-fit p-3 bg-[#F6F7F8]">
        <form class="mx-4" >
            <h3 class=" flex justify-center font-bold text-xl">Add a User</h3>
            <label class="block mt-2">Username</label>
            <input [(ngModel)]="username" type="text" class="border border-[#C8CCD2] rounded-sm shadow-sm h-7 w-[250px]" name="username"/>
            
            <label class="block mt-4">First Name</label>
            <input [(ngModel)]="firstName" type="text" class="border border-[#C8CCD2] rounded-sm shadow-sm h-7 w-[250px]" name="firstName"/>
            
            <label class="block mt-4">Last Name</label>
            <input [(ngModel)]="lastName" type="text" class="border border-[#C8CCD2] rounded-sm shadow-sm h-7 w-[250px]" name="lastName"/>
        
            <label class="block mt-4">E-Mail Address</label>
            <input [(ngModel)]="email" type="email" class="border border-[#C8CCD2] rounded-sm shadow-sm h-7 w-[250px]" name="email"/>
            
            <label class="block mt-4">Password</label>
            <input [(ngModel)]="password" type="password" class="border p-0.5 border-[#C8CCD2] rounded-sm shadow-sm h-7 w-[250px]" name="password"/>
            
            <div class="mt-8 flex justify-end space-x-2">
                <button (click)="closeUserModal()" class="w-[70px] p-1 rounded-lg text-white bg-red-600">Cancel</button>
                <button (click)="addUser(username, firstName, lastName, email, password)" class="w-[70px] p-1 rounded-lg text-white bg-green-500">Add</button>
            </div>
        </form>
    </div>
</div>   
<!--Create Book  Modal-->
<div class="modal" id="new-book-modal">
    <div class="modal-box flex flex-col justify-center items-center w-fit p-6">
        <form class="mx-4">
            <h3 class=" flex justify-center font-bold text-xl">Add a Book</h3>
            
            <label class="block mt-2">Name</label>
            <input [(ngModel)]="bookName" required type="text" class="border border-[#C8CCD2] rounded-sm shadow-sm h-7 w-[350px]" name="bookName"/>

            <label class="block mt-4">Description</label>
            <textarea [(ngModel)]="bookDescription" required class="textarea textarea-bordered w-[350px]" name="bookDescription"></textarea>
            
            <label class="block mt-4">Publish Date</label>
            <input [(ngModel)]="publishDate" required type="date" class="border border-[#C8CCD2] rounded-sm shadow-sm h-7 w-[350px]" name="publishDate"/>
        
            <label class="block mt-4">Authors</label>
            <input [(ngModel)]="authors" required type="text" class="border border-[#C8CCD2] rounded-sm shadow-sm h-7 w-[350px]" name="authors"/>
            
            <label class="block mt-4">Number of Pages</label>
            <input [(ngModel)]="pages" required type="number" pattern="\d+" class="border p-0.5 border-[#C8CCD2] rounded-sm shadow-sm h-7 w-[350px]" name="pages"/>

            <label class="block mt-4">Genres <span class="text-sm">(comma separated list)</span></label>
            <input [(ngModel)]="genres" required type="text" class="border border-[#C8CCD2] rounded-sm shadow-sm h-7 w-[350px]" name="genres"/>
            
            <label class="block mt-4">Image</label>
            <input type="file" accept="image/*" required class="file-input file-input-bordered file-input-sm w-[350px]" name="image"/>
            
            <div class="mt-8 flex justify-end space-x-2">
                <button (click)="closeBookModal()" class="w-[70px] p-1 rounded-lg text-white bg-red-600">Cancel</button>
                <button (click)="addBook(bookName, bookDescription, publishDate, authors, pages, genres, image)" class="w-[70px] p-1 rounded-lg text-white bg-green-500">Add</button>
            </div>
        </form>
    </div>
</div> 